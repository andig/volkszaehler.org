var vz={entities:[],middleware:[],wui:{dialogs:{},timeout:null},capabilities:{definitions:{}},plot:{},options:{}};$(document).ready(function(){window.onerror=function(t,e,i){vz.wui.dialogs.error("Javascript Runtime Error",t)},void 0!==timezoneJS&&void 0!==timezoneJS.Date&&(timezoneJS.timezone.zoneFileBasePath="tz",timezoneJS.timezone.defaultZoneFile=[],timezoneJS.timezone.init({async:!1})),vz.options.middleware.forEach(function(t){vz.middleware.push(new Middleware(t))}),vz.options.plot.xaxis.monthNames=vz.options.monthNames,vz.options.plot.xaxis.dayNames=vz.options.dayNames;var t=$.getUrlParams();if(t.hasOwnProperty("reset")&&t.reset){$.setCookie("vz_entities",null);try{localStorage.removeItem("vz.capabilities")}catch(e){}}vz.entities.loadCookie(),vz.options.loadCookies(),vz.options.plot.xaxis.max=(new Date).getTime(),vz.options.plot.xaxis.min=vz.options.plot.xaxis.max-vz.options.interval,vz.parseUrlParams(),vz.wui.init(),vz.capabilities.load().done(function(){vz.entities.loadDetails().done(function(){0===vz.entities.length&&vz.wui.dialogs.init(),vz.entities.showTable(),vz.entities.inheritVisibility(),vz.entities.loadData().done(function(){vz.wui.drawPlot(),vz.entities.loadTotalConsumption()}),vz.middleware.forEach(function(t){t.loadEntities();var e=document.createElement("a");e.href=t.url;var i=e.hostname||location.host,a=0===(e.protocol||location.protocol).toLowerCase().indexOf("https")?"wss":"ws",o=a+"://"+i;isNaN(parseFloat(t.live))?(e.port&&(o+=":"+e.port),o+="/ws"):o+=":"+t.live,new ab.connect(o,function(e){t.session=e,vz.entities.each(function(i){i.active&&i.middleware.indexOf(t.url)>=0&&i.subscribe(e)},!0)},function(e,i){delete t.session})})})})});var Exception=function(t,e,i){return{type:t,message:e,code:i}};vz.getLink=function(t){var e=[],i="";return vz.entities.each(function(t,a){t.active&&"Volkszaehler\\Model\\Aggregator"!=t.definition.model&&(0===e.length&&(i=t.middleware),t.middleware.indexOf(i)>=0&&e.push(t))},!0),e[0].middleware+"/data."+t+"?"+$.param({from:Math.floor(vz.options.plot.xaxis.min),to:Math.ceil(vz.options.plot.xaxis.max),uuid:e.map(function(t){return t.uuid})})},vz.getPermalink=function(){var t=[];vz.entities.each(function(e,i){if(e.active){var a=e.uuid+"@"+e.middleware;t.indexOf(a)<0&&t.push(a)}});var e={from:Math.floor(vz.options.plot.xaxis.min),to:Math.ceil(vz.options.plot.xaxis.max),uuid:t};return window.location.protocol+"//"+window.location.host+window.location.pathname+"?"+$.param(e)},vz.load=function(t,e){return $.extend(t,{accepts:"application/json",beforeSend:function(t,e){t.requestUrl=e.url}}),void 0===t.url&&(t.url=vz.options.middleware[0].url),void 0!==t.controller&&(t.url+="/"+t.controller),void 0!==t.identifier&&(t.url+="/"+t.identifier),t.url+=".json",void 0===t.data&&(t.data={}),$.ajax(t).then(function(t,e,i){return i.responseJSON||(vz.load.errorHandler(i),$.Deferred().rejectWith(this,[i])),$.Deferred().resolveWith(this,[t])},function(t){return vz.load.errorHandler(t,e)})},vz.load.errorHandler=function(t,e){return e||vz.wui.dialogs.middlewareException(t),t},vz.parseUrlParams=function(){var t=$.getUrlParams(),e=[],i=!1;for(var a in t)if(t.hasOwnProperty(a))switch(a){case"uuid":e="string"==typeof t[a]?[t[a]]:t[a];break;case"save":i=t[a];break;case"from":case"to":vz.options.refresh=!1;var o=/^-?[0-9]+$/.test(t[a])?parseInt(t[a]):new Date(t[a]).getTime();"from"==a?vz.options.plot.xaxis.min=o:vz.options.plot.xaxis.max=o;break;case"style":case"fillstyle":case"linewidth":case"group":case"options":vz.options[a]=t[a];break;case"hide":$(t[a]).hide()}e.forEach(function(t){t=t.split("@");var e=t[0],a=t.length>1?t[1]:vz.options.middleware[0].url,o=new Entity({uuid:e,middleware:a,cookie:i}),n=!1;vz.entities.each(function(t){t.uuid==e&&(n=!0)}),n||vz.entities.push(o)}),i&&vz.entities.saveCookie()},vz.capabilities.load=function(){var t=vz.load({controller:"capabilities"}).done(function(t){$.extend(!0,vz.capabilities,t.capabilities);try{localStorage.setItem("vz.capabilities",JSON.stringify(t))}catch(e){}});try{var e=localStorage.getItem("vz.capabilities");if(e!==!1)return $.extend(!0,vz.capabilities,JSON.parse(e).capabilities),$.Deferred().resolve()}catch(i){}return t},vz.capabilities.definitions.get=function(t,e){for(var i in this[t])if(this[t][i].name==e)return this[t][i]},function(t){t.cachedScript=function(e,i){return i=t.extend(i||{},{dataType:"script",cache:!0,url:e}),t.ajax(i)},t.fn.serializeArrayWithCheckBoxes=function(){return t(this).serializeArray().concat(t(this).find("input[type=checkbox]:not(:checked)").map(function(){return{name:this.name,value:"0"}}).get())}}(jQuery),vz.entities.saveCookie=function(){var t=new Date(2038,0,1),e=[];this.each(function(t){t.cookie===!0&&e.push(t.uuid+"@"+t.middleware+"@"+(t.active?"1":"0"))},!1),$.setCookie("vz_entities",e.join("|"),{expires:t})},vz.entities.loadCookie=function(){var t=$.getCookie("vz_entities");if(t){var e=t.split("|");e.forEach(function(t){var e=t.split("@"),i=null;e.length>2&&(i="1"==e[2]),vz.entities.push(new Entity({middleware:e[1],uuid:e[0],cookie:!0,active:i}))})}},vz.entities.loadDetails=function(){var t=[];return vz.entities.each(function(e){t.push(e.loadDetails(!0).then(function(t){return $.Deferred().resolveWith(this,[t])},function(t){var i=(t.responseJSON||{}).exception;return i&&i.message.match(/^Invalid UUID|^No entity found with UUID/)?(vz.entities.splice(vz.entities.indexOf(e),1),$.Deferred().resolveWith(this,[t.responseJSON])):(vz.wui.dialogs.middlewareException(t),vz.load.errorHandler(t))}))},!0),$.when.apply($,t)},vz.entities.loadData=function(){$("#overlay").html('<img src="img/loading.gif" alt="loading..." /><p>loading...</p>');var t=[];return vz.entities.each(function(e){t.push(e.loadData())},!0),$.when.apply($,t)},vz.entities.loadTotalConsumption=function(){if(vz.options.totalsInterval){var t=[];vz.entities.each(function(e){t.push(e.loadTotalConsumption())},!0),$.when.apply($,t).done(function(){vz.entities.updateTableColumnVisibility(),window.setTimeout(vz.entities.loadTotalConsumption,1e3*vz.options.totalsInterval)})}},vz.entities.speedupFactor=function(){var t=vz.options.group,e=(vz.options.plot.xaxis.max-vz.options.plot.xaxis.min)/36e5;return void 0!==t?t:(e>24*vz.options.tuples/vz.options.speedupFactor?t="day":e>vz.options.tuples/vz.options.speedupFactor&&(t="hour"),t)},vz.entities.each=function(t,e){for(var i=0;i<this.length;i++)t(this[i]),e&&void 0!==this[i]&&this[i].eachChild(t,!0)},vz.entities.dropTableHandler=function(t,e,i,a){a&&(i=$.extend(!0,{},i));var o=[];try{if(e?o.push(e.addChild(i)):($.inArray(i,vz.entities)<0&&vz.entities.push(i),i.cookie=!0,vz.entities.saveCookie()),!a)if(t)o.push(t.removeChild(i));else{i.cookie=!1,vz.entities.saveCookie();var n=$.inArray(i,vz.entities);n>=0&&vz.entities.splice(n,1)}}catch(s){vz.wui.dialogs.exception(s)}finally{$.when.apply($,o).done(function(){var i=[];t&&i.push(t.loadDetails()),e&&i.push(e.loadDetails()),$.when.apply($,i).done(vz.entities.showTable)})}},vz.entities.showTable=function(){$("#entity-list tbody").empty(),vz.entities.sort(Entity.compare),vz.entities.each(function(t,e){t.definition&&$("#entity-list tbody").append(t.getDOMRow(e))},!0),$("#entity-list tr.channel span.indicator, #entity-list tr.aggregator span.indicator").draggable({helper:"clone",opacity:.75,refreshPositions:!0,revert:"invalid",revertDuration:300,scroll:!0}),$("#entity-list tr.aggregator span.indicator, #entity-list thead tr th:first").each(function(){$(this).parents("tr").droppable({accept:"#entity-list tr.channel span.indicator, #entity-list tr.aggregator span.indicator",drop:function(t,e){var i=$(e.draggable.parents("tr")[0]).data("entity");if(null!==i){var a=i.parent,o=$(this).data("entity");if(o!==i&&a!==o&&!(o&&"Volkszaehler\\Model\\Aggregator"==o.definition.model&&$.inArray(i,o.children)>=0))return o&&i.middleware!==o.middleware?void vz.wui.dialogs.error("Fehler","Kanäle können nur in Gruppen der gleichen Middleware verschoben werden."):void $("#entity-move").dialog({resizable:!1,modal:!0,title:"Verschieben",width:400,buttons:{Verschieben:function(){vz.entities.dropTableHandler(a,o,i,!1),$(this).dialog("close")},Kopieren:function(){vz.entities.dropTableHandler(a,o,i,!0),$(this).dialog("close")},Abbrechen:function(){$(this).dialog("close")}}})}},hoverClass:"accept",over:function(t,e){this.id==$(e.draggable.parents("tr")[0]).id||$(this).hasClass("expanded")||$(this).expand()}})}),$("#entity-list table tbody tr").mousedown(function(){var t=$(this).data("entity"),e=$("tr.selected");e.removeClass("selected"),vz.wui.selectedChannel=null,t!==e.data("entity")&&t.active&&($(this).addClass("selected"),vz.wui.selectedChannel=t.uuid),vz.wui.drawPlot()}),$("#entity-list table").treeTable({treeColumn:2,clickableNodeNames:!0,initialState:"expanded"}),vz.entities.updateTableColumnVisibility(),vz.entities.each(function(t){t.updateDOMRow()},!0)},vz.entities.inheritVisibility=function(){vz.entities.each(function(t,e){"Volkszaehler\\Model\\Aggregator"!==t.definition.model&&void 0!==t.parent&&t.active!==t.parent.active&&t.activate(t.parent.active),"Volkszaehler\\Model\\Aggregator"==t.definition.model&&t.active===!1&&(t.activate(!1,t.parent,!0),$("#entity-"+t.uuid+".aggregator").removeClass("expanded").collapse())},!0)},vz.entities.updateTableColumnVisibility=function(){$(".cost").css({display:0===$("tbody .cost").filter(function(){return(+$(this).data("cost")||0)>0}).get().length?"none":""}),$(".total").css({display:0===$("tbody .total").filter(function(){return(+$(this).data("total")||0)>0}).get().length?"none":""})},vz.wui.init=function(){vz.wui.initEvents(),vz.wui.resizePlot(),$(window).resize(vz.wui.resizePlot),$("#accordion h3").click(function(){var t=$(window).height();return $(this).next().toggle(0,function(){vz.wui.resizePlot(null,t)}),!1}).next().hide(),$("#entity-list").show(),$("button, input[type=button],[type=image],[type=submit]").button(),$("button[name=options-save]").click(vz.options.saveCookies),$("button[name=entity-add]").click(this.dialogs.init),$("#export select").change(function(t){vz.wui.exportData($(this).val()),$(this).val("default")}),$("#controls button").click(this.handleControls),$("#controls").controlgroup(),$("#refresh").prop("checked",vz.options.refresh),vz.options.refresh&&(vz.wui.tmaxnow=!0,vz.wui.setTimeout()),$("#refresh").change(function(){vz.options.refresh=$(this).prop("checked"),vz.options.refresh?(vz.wui.refresh(),vz.wui.setTimeout()):vz.wui.clearTimeout()}),$("#entity-toggle").click(function(){vz.entities.each(function(t,e){t.activate(!t.active,e,!1).done(vz.wui.drawPlot)},!0)})},vz.wui.resizePlot=function(t,e){var i=(e||$(window).height())-$("html").height();$("#flot").height(Math.max($("#flot").height()+i,vz.options.plot.minHeight||300)),vz.options.tuples=Math.round($("#flot").width()/3),vz.plot&&vz.plot.resize&&(vz.plot.resize(),vz.plot.setupGrid(),vz.plot.draw())},vz.wui.exportData=function(t){switch(t){case"permalink":window.location=vz.getPermalink();break;case"png":$.when($.cachedScript("js/canvas/Blob.js"),$.cachedScript("js/canvas/canvas-toBlob.js"),$.cachedScript("js/canvas/FileSaver.js")).done(function(){vz.plot.getCanvas().toBlob(function(t){saveAs(t,"Screenshot.png")})});break;case"csv":case"json":case"xml":window.location=vz.getLink(t)}},vz.wui.addEntity=function(t){vz.entities.push(t),vz.entities.saveCookie(),vz.entities.showTable(),vz.options.plot.axesAssigned=!1,t.subscribe();var e=[t.loadData()];t.eachChild(function(t){e.push(t.loadData()),t.subscribe()},!0),$.when.apply($,e).then(function(){vz.wui.drawPlot(),t.loadTotalConsumption().done(vz.entities.updateTableColumnVisibility),t.eachChild(function(t){t.loadTotalConsumption()},!0)})},vz.wui.dialogs.init=function(){function t(t){$("#entity-public-entity").empty(),t["public"].forEach(function(t){$("#entity-public-entity").append($("<option>").html(t.title).val(t.uuid).data("entity",t))})}vz.middleware.forEach(function(t,e){$("#entity-public-middleware, #entity-create-middleware").append($("<option>").val(t.url).text(t.title))}),$("#entity-add.dialog").dialog({title:unescape("Kanal hinzufügen"),width:650,resizable:!1,open:function(){var e=vz.middleware.find($("#entity-public-middleware option:selected").val());t(e),e.loadEntities().done(function(e){t(e)})}}),$("#entity-add.dialog > div").tabs(),vz.capabilities.definitions.entities.forEach(function(t){$("#entity-create select[name=type]").append($("<option>").html(t.translation[vz.options.language]).data("definition",t).val(t.name).css("background-image",t.icon?"url(img/types/"+t.icon:null))}),$("#entity-create option[value=power]").attr("selected","selected"),$("#entity-subscribe-middleware").val(vz.options.middleware[0].url),$("#entity-subscribe-cookie").attr("checked","checked"),$("#entity-public-cookie").attr("checked","checked"),$("#entity-public-middleware").change(function(){t(vz.middleware.find($("#entity-public-middleware option:selected").val()))}),$("#entity-subscribe input[type=button]").click(function(){try{var t=new Entity({uuid:$("#entity-subscribe-uuid").val(),cookie:Boolean($("#entity-subscribe-cookie").prop("checked")),middleware:$("#entity-subscribe-middleware").val()});t.loadDetails().done(function(e){vz.wui.addEntity(t)})}catch(e){vz.wui.dialogs.exception(e)}finally{$("#entity-add").dialog("close")}}),$("#entity-public input[type=button]").click(function(){var t=$.extend({},$("#entity-public-entity option:selected").data("entity"));if(!$.isEmptyObject(t))try{t.cookie=Boolean($("#entity-public-cookie").prop("checked")),vz.wui.addEntity(t)}catch(e){vz.wui.dialogs.exception(e)}finally{$("#entity-add").dialog("close")}}),$("#entity-create select[name=type]").change(function(){$("#entity-create form table .required").remove(),$("#entity-create form table .optional").remove();var t=$("#entity-create form table"),e=vz.capabilities.definitions.entities[$(this)[0].selectedIndex];vz.wui.dialogs.addProperties(t,e.required,"required"),vz.wui.dialogs.addProperties(t,e.optional,"optional"),e.style&&$(t).find("select[name=style] option[value="+e.style+"]").attr("selected","selected")}),$("#entity-create select").change(),$("#entity-create form").submit(function(){var t=$("select[name=type] option:selected",this).data("definition"),e={};return $(this).serializeArray().forEach(function(t){""!==t.value&&(e[t.name]=t.value)}),vz.load({controller:"Volkszaehler\\Model\\Channel"==t.model?"channel":"aggregator",url:$("#entity-create-middleware").val(),data:e,method:"POST"}).done(function(t){var e=new Entity(t.entity,$("#entity-create-middleware").val());try{e.cookie=Boolean($("#entity-create-cookie").prop("checked")),vz.wui.addEntity(e)}catch(i){vz.wui.dialogs.exception(i)}finally{$("#entity-add").dialog("close"),$("<div>").append($("<p>").html(e.uuid)).dialog({title:"Kanal UUID",width:450,resizable:!1,modal:!0,buttons:{Ok:function(){$(this).dialog("close"),$(this).remove()}}})}}),!1}),$("button[name=entity-add]").unbind("click",this.init),$("button[name=entity-add]").click(function(){$("#entity-add.dialog").dialog("open")})},vz.wui.dialogs.addProperties=function(t,e,i,a){e.forEach(function(e){var o=a&&void 0!==typeof a[e]?a[e]:null;("undefined"==typeof o||null===o)&&vz.options.hiddenProperties.indexOf(e)>=0||vz.capabilities.definitions.properties.forEach(function(n,s){if(e==n.name){var l=null,d=$("<tr>").addClass("property").append($("<td>").text(n.translation[vz.options.language]));switch(n.type){case"float":case"integer":case"string":l=$('<input size="36">').attr("type","text");break;case"text":l=$("<textarea>");break;case"boolean":l=$("<input>").attr("type","checkbox").val("1");break;case"multiple":l=$("<select>").attr("Size","1"),n.options.forEach(function(t,e){l.append($("<option>").html(t).val(t))})}if(a&&null!==l)switch(n.type){case"float":case"integer":case"string":case"text":l.val(o);break;case"boolean":l.attr("checked",o);break;case"multiple":l.find('option[value="'+o+'"]').attr("selected","selected")}switch(n.name){case"fillstyle":l=$('<div id="slider"></div>').slider({value:a?a[e]:0,min:n.min,max:n.max,step:(n.max-n.min)/20,slide:function(t,e){$(".simpleColorChooser").hide(),$("#slider input").val(e.value)}}).append($("<input>").attr("type","hidden").attr("name",n.name).val(a?a[e]:0));break;case"color":l=$("<input>").attr("type","hidden").attr("name",n.name).val(a?a[e]:"aqua"),$.cachedScript("js/jquery/jquery.simple-color.min.js").done(function(){l.simpleColor({cellWidth:18,cellHeight:18,chooserCSS:{"border-color":"#a7a7a7","z-index":20},displayCSS:{"border-color":"#a7a7a7"},boxWidth:50,columns:19,colors:["ffebee","fce4ec","f3e5f5","ede7f6","e8eaf6","e3f2fd","e1f5fe","e0f7fa","e0f2f1","e8f5e9","f1f8e9","f9fbe7","fffde7","fff8e1","fff3e0","fbe9e7","efebe9","eceff1","ffffff","ffcdd2","f8bbd0","e1bee7","d1c4e9","c5cae9","bbdefb","b3e5fc","b2ebf2","b2dfdb","c8e6c9","dcedc8","f0f4c3","fff9c4","ffecb3","ffe0b2","ffccbc","d7ccc8","cfd8dc","f5f5f5","ef9a9a","f48fb1","ce93d8","b39ddb","9fa8da","90caf9","81d4fa","80deea","80cbc4","a5d6a7","c5e1a5","e6ee9c","fff59d","ffe082","ffcc80","ffab91","bcaaa4","b0bec5","e0e0e0","e57373","f06292","ba68c8","9575cd","7986cb","64b5f6","4fc3f7","4dd0e1","4db6ac","81c784","aed581","dce775","fff176","ffd54f","ffb74d","ff8a65","a1887f","90a4ae","bdbdbd","ef5350","ec407a","ab47bc","7e57c2","5c6bc0","42a5f5","29b6f6","26c6da","26a69a","66bb6a","9ccc65","d4e157","ffee58","ffca28","ffa726","ff7043","8d6e63","78909c","9e9e9e","f44336","e91e63","9c27b0","673ab7","3f51b5","2196f3","03a9f4","00bcd4","009688","4caf50","8bc34a","cddc39","ffeb3b","ffc107","ff9800","ff5722","795548","607d8b","757575","e53935","d81b60","8e24aa","5e35b1","3949ab","1e88e5","039be5","00acc1","00897b","43a047","7cb342","c0ca33","fdd835","ffb300","fb8c00","f4511e","6d4c41","546e7a","616161","d32f2f","c2185b","7b1fa2","512da8","303f9f","1976d2","0288d1","0097a7","00796b","388e3c","689f38","afb42b","fbc02d","ffa000","f57c00","e64a19","5d4037","455a64","424242","c62828","ad1457","6a1b9a","4527a0","283593","1565c0","0277bd","00838f","00695c","2e7d32","558b2f","9e9d24","f9a825","ff8f00","ef6c00","d84315","4e342e","37474f","212121","b71c1c","880e4f","4a148c","311b92","1a237e","0d47a1","01579b","006064","004d40","1b5e20","33691e","827717","f57f17","ff6f00","e65100","bf360c","3e2723","263238","000000"]})})}return null!==l&&(d.addClass(i),l.attr("name",n.name),d.append($("<td>").append(l)),t.append(d)),!1}})})},vz.wui.zoomToPartialUpdate=function(t){if(vz.wui.tmaxnow){var e=t-vz.options.plot.xaxis.max;vz.options.plot.xaxis.max=t,vz.options.plot.xaxis.min+=e,vz.wui.pushRedrawTimeout=window.setTimeout(function(){vz.wui.pushRedrawTimeout=null,vz.wui.drawPlot()},vz.options.pushRedrawTimeout)}else window.clearTimeout(vz.wui.pushRedrawTimeout)},vz.wui.initEvents=function(){$("#plot").bind("plotselected",function(t,e){vz.wui.period=null,vz.wui.zoom(e.xaxis.from,e.xaxis.to)}).bind("plothover",function(t,e,i){vz.entities&&vz.entities.length&&(vz.wui.latestPosition=e,vz.wui.updateLegendTimeout||(vz.wui.updateLegendTimeout=setTimeout(vz.wui.updateLegend,50)))})},vz.wui.updateLegend=function(){vz.wui.updateLegendTimeout=null;var t=vz.wui.latestPosition,e=vz.plot.getAxes();if(!(t.x<e.xaxis.min||t.x>e.xaxis.max||t.y<e.yaxis.min||t.y>e.yaxis.max)){var i,a,o=vz.plot.getData();for(i=0;i<o.length;++i){var n=o[i];if(n.data.length){for(a=0;a<n.data.length&&!(n.data[a][0]>t.x);++a);var s;if(n.lines.steps){var l=n.data[a-1];s=l?l[1]:null}else if(n.lines.states){if(s=null,a<n.data.length){var d=n.data[a];d&&(s=d[1])}}else{var r=n.data[a-1],c=n.data[a];s=null==r||null==c?null:r[1]+(c[1]-r[1])*(t.x-r[0])/(c[0]-r[0])}var p=$(".legend .legendLabel");if(null===s)p.eq(i).text(n.title);else{var u=$.plot.dateGenerator(t.x,vz.options.plot.xaxis),h=vz.options.plot.xaxis.max-vz.options.plot.xaxis.min,v=h>864e5?"%d.%m.%y - %H:%M":"%H:%M:%S";p.eq(i).text(n.title+": "+$.plot.formatDate(u,v)+" - "+vz.wui.formatNumber(s,n.unit))}}}$(".legend > div").css({width:$(".legend table").css("width")})}},vz.wui.handleControls=function(){var t,e=vz.options.plot.xaxis.max-vz.options.plot.xaxis.min,i=vz.options.plot.xaxis.min+e/2,a=$(this).val();switch(a){case"move-last":t="week"==vz.wui.period?"isoweek":vz.wui.period,vz.wui.zoom(vz.wui.period&&moment(vz.options.plot.xaxis.min).startOf(t).isSame(moment(vz.options.plot.xaxis.min))?moment().startOf(t).valueOf():moment().valueOf()-e,moment().valueOf());break;case"move-back":vz.wui.period?vz.wui.zoom(moment(vz.options.plot.xaxis.min).subtract(1,vz.wui.period).valueOf(),vz.options.plot.xaxis.min):vz.wui.zoom(vz.options.plot.xaxis.min-e,vz.options.plot.xaxis.max-e);break;case"move-forward":if(vz.wui.tmaxnow)break;vz.wui.period?vz.wui.zoom(vz.options.plot.xaxis.max,Math.min(moment(vz.options.plot.xaxis.max).add(1,vz.wui.period).valueOf(),moment().valueOf())):vz.wui.zoom(vz.options.plot.xaxis.min+e,vz.options.plot.xaxis.max+e);break;case"zoom-reset":vz.wui.period=null,vz.wui.zoom(i-vz.options.defaultInterval/2,i+vz.options.defaultInterval/2);break;case"zoom-in":vz.wui.period=null,vz.wui.tmaxnow?vz.wui.zoom(moment().valueOf()-e/2,moment().valueOf()):vz.wui.zoom(i-e/4,i+e/4);break;case"zoom-out":vz.wui.period=null,vz.wui.zoom(i-e,i+e);break;case"zoom-hour":case"zoom-day":case"zoom-week":case"zoom-month":case"zoom-year":var o,n,s=a.split("-")[1];t="week"==s?"isoweek":s,vz.wui.tmaxnow?(o=s===vz.wui.period?moment().subtract(1,s).valueOf():moment().startOf(t).valueOf(),n=moment().valueOf()):(o=moment(i).startOf(t).valueOf(),n=moment(i).startOf(t).add(1,s).valueOf()),vz.wui.period=s,vz.wui.zoom(o,Math.min(n,moment().valueOf()))}},vz.wui.zoom=function(t,e){var i=(new Date).getTime();if(e>i){var a=e-t;vz.options.plot.xaxis.min=i-a,vz.options.plot.xaxis.max=i}else vz.options.plot.xaxis.min=t,vz.options.plot.xaxis.max=e;vz.wui.tmaxnow=vz.options.plot.xaxis.max>=i-1e3,vz.options.plot.xaxis.min<0&&(vz.options.plot.xaxis.min=0),vz.entities.loadData().done(vz.wui.drawPlot)},vz.wui.refresh=function(){var t=vz.options.plot.xaxis.max-vz.options.plot.xaxis.min;vz.wui.zoom((new Date).getTime()-t,(new Date).getTime())},vz.wui.setTimeout=function(){null!==vz.wui.timeout&&(window.clearTimeout(vz.wui.timeout),vz.wui.timeout=null);var t=Math.max((vz.options.plot.xaxis.max-vz.options.plot.xaxis.min)/vz.options.tuples,vz.options.minTimeout);vz.wui.timeout=window.setTimeout(vz.wui.refresh,t),$("#refresh-time").html("("+Math.round(t/1e3)+" s)")},vz.wui.clearTimeout=function(t){$("#refresh-time").html(t||"");var e=window.clearTimeout(vz.wui.timeout);return vz.wui.timeout=null,e},vz.wui.formatNumber=function(t,e,i){i=i||!0;var a=["k","M","G","T"],o=0,n="string"==typeof i?a.indexOf(i)+1:a.length;for(["l","m3","m^3","m³","l/h","m3/h","m/h^3","m³/h","hPa"].indexOf(e)>=0&&(n=-1,Math.abs(t)>1e3&&("l"==e||"l/h"==e)&&(e="m³"+e.substring(1),t/=1e3));i&&Math.abs(t)>1e3&&o<n;)t/=1e3,o++;if(t<0||t>0){var s=Math.max(0,vz.options.precision-Math.floor(Math.log(Math.abs(t))/Math.LN10));void 0!==vz.options.maxPrecision[e]&&(s=Math.min(vz.options.maxPrecision[e],s)),t=Math.round(t*Math.pow(10,s))/Math.pow(10,s)}return Math.abs(t)<Math.pow(10,-vz.options.precision)&&(t=0),t+=i&&o>0?" "+a[o-1]:" ",e&&(t+=e),t},vz.wui.formatConsumptionUnit=function(t){var e="/h";return t.indexOf(e,t.length-e.length)!==-1?t=t.substring(0,t.length-e.length):"h"!==t&&(t+="h"),t},vz.wui.tickFormatter=function(t,e,i,a){if(a&&i===a.length-1&&e.options.axisLabel)return"["+e.options.axisLabel+"]";var o=e.tickDecimals?Math.pow(10,e.tickDecimals):1,n=""+Math.round(t*o)/o;if(null!==e.tickDecimals){var s=n.indexOf("."),l=s==-1?0:n.length-s-1;if(l<e.tickDecimals)return(l?n:n+".")+(""+o).substr(1,e.tickDecimals-l)}return n},vz.wui.updateHeadline=function(){var t=vz.options.plot.xaxis.max-vz.options.plot.xaxis.min,e="%a %e. %b %Y",i=vz.options.plot.xaxis.min,a=vz.options.plot.xaxis.max;t<2592e5?(e+=" %H:%M",t<3e5&&(e+=":%S")):a--,i=$.plot.formatDate($.plot.dateGenerator(i,vz.options.plot.xaxis),e,vz.options.monthNames,vz.options.dayNames,!0),a=$.plot.formatDate($.plot.dateGenerator(a,vz.options.plot.xaxis),e,vz.options.monthNames,vz.options.dayNames,!0),$("#title").html(i+" - "+a)},vz.wui.drawPlot=function(){vz.options.interval=vz.options.plot.xaxis.max-vz.options.plot.xaxis.min,vz.wui.updateHeadline(),vz.options.plot.axesAssigned===!1&&(vz.entities.each(function(t){t.assignAxis()},!0),vz.options.plot.axesAssigned=!0);var t=[];vz.entities.each(function(e){if(e.active&&e.definition&&"Volkszaehler\\Model\\Channel"==e.definition.model&&e.data&&e.data.tuples&&e.data.tuples.length>0){var i,a=0,o=e.data.tuples.map(function(t){return t.slice(0)}),n=vz.options.style||e.style,s=parseFloat(vz.options.fillstyle||e.fillstyle),l=parseFloat(vz.options.linewidth||vz.options[e.uuid==vz.wui.selectedChannel?"lineWidthSelected":"lineWidthDefault"]);if("steps"==n)for(o.unshift([e.data.from,1,1]),i=0;i<o.length-1;i++)o[i][1]=o[i+1][1];if(s||e.gap)for(i=0;i<o.length;i++)a=Math.max(a,o[i][2]),delete o[i][2];var d={data:o,color:e.color,label:e.title,title:e.title,unit:e.definition.unit,lines:{show:"lines"==n||"steps"==n||"states"==n,steps:"steps"==n||"states"==n,fill:void 0!==s&&s,lineWidth:l},points:{show:"points"==n},yaxis:e.assignedYaxis};if(e.gap){var r=(e.data.to-e.data.from)/o.length;d.xGapThresh=Math.max(1e3*e.gap*a,r),vz.options.plot.xaxis.insertGaps=!0}t.push(d)}},!0),0===t.length?($("#overlay").html('<img src="img/empty.png" alt="no data..." /><p>nothing to plot...</p>'),t.push({})):$("#overlay").empty(),vz.plot=$.plot($("#flot"),t,vz.options.plot),vz.wui.legend=$(".legend .legendLabel"),vz.options.refresh?vz.wui.tmaxnow?vz.wui.setTimeout():vz.wui.clearTimeout("(suspended)"):vz.wui.clearTimeout()},vz.wui.dialogs.error=function(t,e,i){i&&(t=i+": "+t),vz.wui.errorDialog=!0,$("<div>").append($("<span>").html(e)).dialog({title:t,width:450,dialogClass:"ui-error",resizable:!1,modal:!0,close:function(){vz.wui.errorDialog=!1},buttons:{Ok:function(){$(this).dialog("close")}}})},vz.wui.dialogs.exception=function(t){vz.wui.errorDialog||this.error(t.type,t.message,t.code)},vz.wui.dialogs.middlewareException=function(t){t.responseJSON&&t.responseJSON.exception?this.exception(new Exception(t.responseJSON.exception.type,"<a href='"+t.requestUrl+"' style='text-decoration:none'>"+t.requestUrl+"</a>:<br/><br/>"+t.responseJSON.exception.message)):this.exception(new Exception("Network Error",t.statusText))};var Entity=function(t,e){this.parseJSON($.extend({middleware:e},t))};Entity.colors=0,Entity.prototype.parseJSON=function(t){if($.extend(!0,this,t),vz.options.plot.axesAssigned=!1,this.children){for(var e=0;e<this.children.length;e++)this.children[e]=new Entity(this.children[e],this.middleware),this.children[e].parent=this;this.children.sort(Entity.compare)}void 0!==this.type&&(this.definition=vz.capabilities.definitions.get("entities",this.type),void 0===this.style&&(this.definition.style?this.style=this.definition.style:this.style="Volkszaehler\\Interpreter\\SensorInterpreter"==this.definition.interpreter?"lines":"steps")),void 0!==this.active&&null!==this.active||(this.active=!0),void 0===this.color&&(this.color=vz.options.plot.colors[Entity.colors++%vz.options.plot.colors.length]),void 0===this.data&&(this.data={tuples:[]})},Entity.prototype.getUnit=function(){return this.definition.unit||this.unit||""},Entity.prototype.assignMatchingAxis=function(){this.definition&&(vz.options.plot.yaxes.some(function(t,e){if(void 0===t.axisLabel||this.getUnit()==t.axisLabel)return this.assignedYaxis=e+1,!0},this)===!1&&(this.assignedYaxis=vz.options.plot.yaxes.push($.extend({},vz.options.plot.yaxes[1]))),vz.options.plot.yaxes[this.assignedYaxis-1].axisLabel=this.getUnit())},Entity.prototype.assignAxis=function(){if(void 0===this.yaxis||"auto"==this.yaxis)this.assignMatchingAxis();else{for(this.assignedYaxis=parseInt(this.yaxis);vz.options.plot.yaxes.length<this.assignedYaxis;)vz.options.plot.yaxes.push($.extend({},vz.options.plot.yaxes[1]));var t=vz.options.plot.yaxes[this.assignedYaxis-1];void 0===t.forcedGroup&&void 0!==t.axisLabel&&this.getUnit()!==t.axisLabel&&(t.axisLabel="*",vz.entities.each(function(t){t.assignedYaxis!=this.yaxis||void 0!==t.yaxis&&"auto"!=t.yaxis||t.assignMatchingAxis()}.bind(this),!0)),t.axisLabel=this.getUnit(),t.forcedGroup=this.yaxis}this.updateAxisScale()},Entity.prototype.updateAxisScale=function(){void 0!==this.assignedYaxis&&vz.options.plot.yaxes.length>=this.assignedYaxis&&(void 0===vz.options.plot.yaxes[this.assignedYaxis-1].min&&(vz.options.plot.yaxes[this.assignedYaxis-1].min=0),this.data&&this.data.tuples&&this.data.tuples.length>0&&this.data.min&&this.data.min[1]<0&&(vz.options.plot.yaxes[this.assignedYaxis-1].min=null))},Entity.prototype.subscribe=function(t){var e=vz.middleware.find(this.middleware);e&&e.session&&(t=t||e.session),t&&t.subscribe(this.uuid,function(t,e){var i=JSON.parse(e);if(!i.data||i.data.uuid!==this.uuid)return!1;if(this.active&&void 0!==this.data){var a=i.data;if(a.tuples&&a.tuples.length)for(var o=this.data.tuples.length?this.data.tuples[this.data.tuples.length-1][0]:0,n=0;n<a.tuples.length;n++)if(a.tuples[n][0]>o){var s=0,l=a.tuples.slice(n);if(l.forEach(function(t,e){(void 0===this.data.min||t[1]<this.data.min[1])&&(this.data.min=t),(void 0===this.data.max||t[1]>this.data.max[1])&&(this.data.max=t);var i=0===e?t[0]-o:t[0]-l[e-1][0];s+=t[1]*i}.bind(this)),s/=36e5,void 0!==this.data.consumption){this.data.consumption=(this.data.consumption||0)+s;for(var d=l[l.length-1][0]-vz.options.plot.xaxis.max+vz.options.plot.xaxis.min;this.data.tuples.length&&this.data.tuples[0][0]<d;){var r=this.data.tuples.shift();this.data.consumption-=r[1]*(r[0]-this.data.from)/36e5,this.data.from=r[0]}}void 0!==this.initialconsumption&&(this.totalconsumption=(this.totalconsumption||0)+s),Array.prototype.push.apply(this.data.tuples,l),this.dataUpdated(),vz.wui.zoomToPartialUpdate(l[l.length-1][0]);break}}}.bind(this))},Entity.prototype.unsubscribe=function(){var t=vz.middleware.find(this.middleware);t.session&&t.session.unsubscribe(this.uuid)},Entity.prototype.hasData=function(){return this.active&&this.definition&&"Volkszaehler\\Model\\Channel"==this.definition.model},Entity.prototype.dataUpdated=function(t){this.updateAxisScale(),this.updateDOMRow()},Entity.prototype.loadDetails=function(t){return delete this.children,vz.load({url:this.middleware,controller:"entity",identifier:this.uuid,context:this},t).done(function(t){delete t.entity.active,this.parseJSON(t.entity),this.eachChild(function(t){t.active=!0},!0)})},Entity.prototype.loadData=function(){return this.hasData()?vz.load({controller:"data",url:this.middleware,identifier:this.uuid,context:this,data:{from:Math.floor(vz.options.plot.xaxis.min),to:Math.ceil(vz.options.plot.xaxis.max),tuples:void 0===vz.options.group?vz.options.tuples:Number.MAX_SAFE_INTEGER,group:vz.entities.speedupFactor()}}).done(function(t){this.data=t.data,this.dataUpdated()}):$.Deferred().resolve().promise()},Entity.prototype.loadTotalConsumption=function(){return void 0===this.initialconsumption?$.Deferred().resolve().promise():vz.load({controller:"data",url:this.middleware,identifier:this.uuid,context:this,data:{from:0,tuples:1,group:"day"}}).done(function(t){this.totalconsumption=(this.definition.scale||1)*this.initialconsumption+t.data.consumption,this.updateDOMRowTotal()})},Entity.prototype.showDetails=function(){var t=this,e=$("<div>");e.addClass("details").append(this.getDOMDetails()).dialog({title:"Details für "+this.title,width:480,resizable:!1,buttons:{Daten:function(){var e=$.extend($.getUrlParams(),{from:Math.floor(vz.options.plot.xaxis.min),to:Math.ceil(vz.options.plot.xaxis.max)});window.open(t.middleware+"/data/"+t.uuid+".json?"+$.param(e),"_blank")},"Löschen":function(){$("#entity-delete").dialog({resizable:!1,modal:!0,title:"Löschen",width:400,buttons:{"Löschen":function(){t["delete"]().done(function(){t.cookie=!1,vz.entities.saveCookie(),vz.entities.each(function(e,i){if(t.uuid==e.uuid){var a=i?i.children:vz.entities;a.splice(a.indexOf(e),1)}},!0),vz.entities.showTable(),vz.wui.drawPlot(),e.dialog("close")}),$(this).dialog("close")},Abbrechen:function(){
$(this).dialog("close")}}})},Bearbeiten:function(){$("#entity-edit form table .required").remove(),$("#entity-edit form table .optional").remove(),vz.capabilities.definitions.entities.some(function(e){if(e.name==t.type){e.optional.indexOf("active")>=0&&e.optional.splice(e.optional.indexOf("active"),1);var i=$("#entity-edit table");return vz.wui.dialogs.addProperties(i,e.required,"required",t),vz.wui.dialogs.addProperties(i,e.optional,"optional",t),!0}}),$("#entity-edit").dialog({resizable:!1,modal:!0,title:"Bearbeiten von "+t.title,width:600,buttons:{Speichern:function(){var i={};$(this).find("form").serializeArrayWithCheckBoxes().forEach(function(e){(""!==e.value||t[e.name])&&(i[e.name]=e.value)}),vz.load({controller:"entity",identifier:t.uuid,url:t.middleware,data:i,method:"PATCH"}).done(function(i){t.parseJSON(i.entity);try{vz.entities.showTable(),vz.entities.loadData().done(vz.wui.drawPlot)}catch(a){vz.wui.dialogs.exception(a)}finally{$("#entity-edit").dialog("close"),e.dialog("close")}})},Abbrechen:function(){$(this).dialog("close")}}})},"Schließen":function(){$(this).dialog("close")}},open:function(){$(this).siblings(".ui-dialog-buttonpane").find("button:eq(0)").focus()}})},Entity.prototype.getDOMDetails=function(t){var e=$("<table><thead><tr><th>Eigenschaft</th><th>Wert</th></tr></thead></table>"),i=$("<tbody>"),a=["uuid","middleware","type","cookie"],o=["required","optional"];return a.forEach(function(t){var e=vz.capabilities.definitions.get("properties",t),a=e?e.translation[vz.options.language]:t,o=this[t];switch(t){case"type":a="Typ";var n=this.definition.icon?$("<img>").attr("src","img/blank.png").addClass("icon-"+this.definition.icon.replace(".png","")).css("margin-right",4):null;o=$("<span>").text(this.definition.translation[vz.options.language]).prepend(n?n:null);break;case"middleware":a="Middleware",o='<a href="'+this.middleware+'/capabilities.json">'+this.middleware+"</a>";break;case"uuid":a="UUID",o='<a href="'+this.middleware+"/entity/"+this.uuid+'.json">'+this.uuid+"</a>";break;case"cookie":a="Cookie",o='<img src="img/blank.png" class="icon-'+(this.cookie?"tick":"cross")+'" alt="'+(o?"ja":"nein")+'" />';break;case"active":o='<img src="img/blank.png" class="icon-'+(this.active?"tick":"cross")+'" alt="'+(this.active?"ja":"nein")+'" />';break;case"style":switch(this.style){case"lines":o="Linien";break;case"steps":o="Stufen";break;case"points":o="Punkte"}}i.append($("<tr>").addClass("property").addClass("general").append($("<td>").addClass("key").text(a)).append($("<td>").addClass("value").append(o)))},this),o.forEach(function(t){this.definition[t].forEach(function(e){if(this.hasOwnProperty(e)&&a.indexOf(e)<0){var o,n=vz.capabilities.definitions.get("properties",e),s=n.translation[vz.options.language],l=this[e];switch("boolean"==n.type&&(l='<img src="img/blank.png" class="icon-'+(this.active?"tick":"cross")+'" alt="'+(l?"ja":"nein")+'" />'),e){case"cost":o=1e3==this.definition.scale?" ct/k":" ct/",l=Number(100*l).toFixed(2)+o+vz.wui.formatConsumptionUnit(this.getUnit());break;case"resolution":o=this.getUnit()&&1e3==this.definition.scale?"k":"",l+="/"+o+vz.wui.formatConsumptionUnit(this.getUnit());break;case"color":l=$("<span>").text(this.color).css("background-color",this.color).css("padding-left",5).css("padding-right",5);break;case"style":switch(this.style){case"lines":l="Linien";break;case"steps":l="Stufen";break;case"points":l="Punkte"}}i.append($("<tr>").addClass("property").addClass(t).append($("<td>").addClass("key").text(s)).append($("<td>").addClass("value").append(l)))}},this)},this),e.append(i)},Entity.prototype.getDOMRow=function(t){var e=this.definition.translation[vz.options.language];vz.options.shortenLongTypes&&(e=e.replace(/\s*\(.+?\)/,""));var i=$("<tr>").addClass(t?"child-of-entity-"+t.uuid:"").addClass("Volkszaehler\\Model\\Aggregator"==this.definition.model?"aggregator":"channel").addClass("entity").attr("id","entity-"+this.uuid).append($("<td>").addClass("visibility").css("background-color",this.color).append($("<input>").attr("type","checkbox").attr("checked",this.active).bind("change",this,function(t){var e=t.data;e.activate($(this).prop("checked"),null,!0).done(vz.wui.drawPlot),vz.entities.saveCookie()}))).append($("<td>").addClass("expander")).append($("<td>").append($("<span>").addClass("indicator").append($("<img>").attr("src","img/blank.png").addClass("icon-"+this.definition.icon.replace(".png",""))).append($("<span>").text(this.title)))).append($("<td>").addClass("type").text(e)).append($("<td>").addClass("min")).append($("<td>").addClass("max")).append($("<td>").addClass("average")).append($("<td>").addClass("last")).append($("<td>").addClass("consumption")).append($("<td>").addClass("cost")).append($("<td>").addClass("total")).append($("<td>").addClass("ops").append($("<input>").attr("type","image").attr("src","img/blank.png").addClass("icon-information").attr("alt","details").bind("click",this,function(t){t.data.showDetails()}))).data("entity",this);return this.cookie&&$("td.ops",i).prepend($("<input>").attr("type","image").attr("src","img/blank.png").addClass("icon-delete").attr("alt","delete").bind("click",this,function(t){vz.entities.splice(vz.entities.indexOf(t.data),1),vz.entities.saveCookie(),vz.entities.showTable(),vz.wui.drawPlot()})),i},Entity.prototype.activate=function(t,e,i){this.active=t,$("#entity-"+this.uuid+(e?".child-of-entity-"+e.uuid:"")+" input[type=checkbox]").prop("checked",t);var a=[];return this.active?(a.push(this.loadData()),this.subscribe()):(this.data=void 0,this.updateDOMRow(),this.unsubscribe()),i&&this.eachChild(function(e,i){a.push(e.activate(t,i,!1))},!0),$.when.apply($,a)},Entity.prototype.updateDOMRow=function(){var t=$("#entity-"+this.uuid);if($(".min",t).text("").attr("title",""),$(".max",t).text("").attr("title",""),$(".average",t).text(""),$(".last",t).text(""),$(".consumption",t).text(""),$(".cost",t).text(""),this.data&&this.data.rows>0){var e=31536e6/(this.data.to-this.data.from),i=this.getUnit();if(this.data.to&&t.toggleClass("stale",vz.options.plot.xaxis.max-this.data.to>(vz.options.plot.stale||864e5)),this.data.min&&$(".min",t).text(vz.wui.formatNumber(this.data.min[1],i)).attr("title",$.plot.formatDate(new Date(this.data.min[0]),"%d. %b %y %H:%M:%S",vz.options.monthNames,vz.options.dayNames,!0)),this.data.max&&$(".max",t).text(vz.wui.formatNumber(this.data.max[1],i)).attr("title",$.plot.formatDate(new Date(this.data.max[0]),"%d. %b %y %H:%M:%S",vz.options.monthNames,vz.options.dayNames,!0)),void 0!==this.data.average&&$(".average",t).text(vz.wui.formatNumber(this.data.average,i)),this.data.tuples&&this.data.tuples.length>0&&$(".last",t).text(vz.wui.formatNumber(this.data.tuples[this.data.tuples.length-1][1],i)),void 0!==this.data.consumption){var a=vz.wui.formatConsumptionUnit(i);$(".consumption",t).text(vz.wui.formatNumber(this.data.consumption,a)).attr("title",vz.wui.formatNumber(this.data.consumption*e,a)+"/Jahr")}if(this.cost){var o=this.cost*this.data.consumption/(this.definition.scale||1);$(".cost",t).data("cost",o).text(o.toFixed(2)+" €").attr("title",(o*e).toFixed(2)+" €/Jahr")}else $(".cost",t).data("cost",0)}this.updateDOMRowTotal(),vz.entities.updateTableColumnVisibility()},Entity.prototype.updateDOMRowTotal=function(){var t=$("#entity-"+this.uuid);if(this.totalconsumption){var e=vz.wui.formatConsumptionUnit(this.definition.unit);$(".total",t).data("total",this.totalconsumption).text(vz.wui.formatNumber(this.totalconsumption,e,"k"))}else $(".total",t).data("total",0).text("")},Entity.prototype["delete"]=function(){return vz.load({controller:"entity",context:this,identifier:this.uuid,url:this.middleware,method:"DELETE"})},Entity.prototype.addChild=function(t){if("Volkszaehler\\Model\\Aggregator"!=this.definition.model)throw new Exception("EntityException","Entity is not an Aggregator");return vz.load({controller:"group",identifier:this.uuid,url:this.middleware,method:"POST",data:{uuid:t.uuid}})},Entity.prototype.removeChild=function(t){if("Volkszaehler\\Model\\Aggregator"!=this.definition.model)throw new Exception("EntityException","Entity is not an Aggregator");return delete t.parent,vz.load({controller:"group",identifier:this.uuid,url:this.middleware,method:"DELETE",data:{uuid:t.uuid}})},Entity.prototype.eachChild=function(t,e){if(this.children)for(var i=0;i<this.children.length;i++)t(this.children[i],this),e&&this.children[i].children&&this.children[i].eachChild(t,!0)},Entity.compare=function(t,e){return void 0===t.definition?-1:void 0===e.definition?1:"Volkszaehler\\Model\\Channel"==t.definition.model&&"Volkszaehler\\Model\\Aggregator"==e.definition.model?-1:"Volkszaehler\\Model\\Aggregator"==t.definition.model&&"Volkszaehler\\Model\\Channel"==e.definition.model?1:t.title<e.title?-1:t.title>e.title?1:0};